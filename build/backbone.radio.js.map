{"version":3,"file":"backbone.radio.js","sources":["../src/utils.js","../src/events.js","../src/requests.js","../src/index.js"],"sourcesContent":["import { once, reduce, keys } from 'underscore';\n\n// Regular expression used to split event strings.\nconst eventSplitter = /\\s+/;\n\n// Iterates over the standard `event, callback` (as well as the fancy multiple\n// space-separated events `\"change blur\", callback` and jQuery-style event\n// maps `{event: callback}`).\nfunction buildEventArgs (name, callback, context, listener) {\n  if (name && typeof name === 'object') {\n    return reduce(keys(name), (eventArgs, key) => {\n      return eventArgs.concat(buildEventArgs(key, name[key], context || callback, listener));\n    }, []);\n  }\n\n  if (name && eventSplitter.test(name)) {\n    return reduce(name.split(eventSplitter), (eventArgs, n) => {\n      eventArgs.push({ name: n, callback, context, listener } );\n      return eventArgs;\n    }, []);\n  }\n\n  return [{ name, callback, context, listener }];\n}\n\n// An optimized way to execute callbacks.\nfunction callHandler(callback, context, args) {\n  switch (args.length) {\n    case 0: return callback.call(context);\n    case 1: return callback.call(context, args[0]);\n    case 2: return callback.call(context, args[0], args[1]);\n    case 3: return callback.call(context, args[0], args[1], args[2]);\n    default: return callback.apply(context, args);\n  }\n}\n\n// If callback is not a function return the callback and flag it for removal\nfunction makeCallback(callback) {\n  if (typeof callback === 'function') {\n    return callback;\n  }\n  const result = function() { return callback; };\n  result._callback = callback;\n  return result;\n}\n\n\n// Wrap callback in a once. Returns for requests\n// `offCallback` unbinds the `onceWrapper` after it has been called.\nfunction onceWrap(callback, offCallback) {\n  const onceCallback = once(function() {\n    offCallback(onceCallback);\n    return callback.apply(this, arguments);\n  });\n\n  onceCallback._callback = callback;\n\n  return onceCallback;\n}\n\nexport {\n  buildEventArgs,\n  callHandler,\n  eventSplitter,\n  makeCallback,\n  onceWrap,\n};\n","import { reduce, each, keys, uniqueId } from 'underscore';\n\nimport { buildEventArgs, callHandler, eventSplitter, onceWrap } from './utils';\n\n// Events\n// ---------------\n\n\n// A module that can be mixed in to *any object* in order to provide it with\n// a custom event channel. You may bind a callback to an event with `on` or\n// remove with `off`; `trigger`-ing an event fires all callbacks in\n// succession.\n//\n//     var object = {};\n//     _.extend(object, Events);\n//     object.on('expand', function(){ alert('expanded'); });\n//     object.trigger('expand');\n//\n\n// The reducing API that adds a callback to the `events` object.\nconst onApi = function({ events, name, callback, context, ctx, listener }) {\n  const handlers = events[name] || (events[name] = []);\n  handlers.push({ callback, context, ctx: context || ctx, listener });\n  return events;\n};\n\nconst onReducer = function(events, { name, callback, context }) {\n  if (!callback) return events;\n  return onApi({ events, name, callback, context, ctx: this });\n}\n\nconst onceReducer = function(events, { name, callback, context }) {\n  if (!callback) return events;\n  const onceCallback = onceWrap(callback, this.off.bind(this, name));\n  return onApi({ events, name, callback: onceCallback, context, ctx: this });\n}\n\nconst cleanupListener = function({ obj, listeneeId, listenerId, listeningTo }) {\n  delete listeningTo[listeneeId];\n  delete obj._listeners[listenerId];\n};\n\n// The reducing API that removes a callback from the `events` object.\nconst offReducer = function(events , { name, callback, context }) {\n  const names = name ? [name] : keys(events);\n\n  each(names, key => {\n    const handlers = events[key];\n\n    // Bail out if there are no events stored.\n    if (!handlers) return;\n\n      // Find any remaining events.\n    events[key] = reduce(handlers, (remaining, handler) => {\n      if (\n        callback && callback !== handler.callback &&\n          callback !== handler.callback._callback ||\n            context && context !== handler.context\n      ) {\n        remaining.push(handler);\n        return remaining;\n      }\n\n      // If not including event, clean up any related listener\n      if (handler.listener) {\n        const listener = handler.listener;\n        listener.count--;\n        if (!listener.count) cleanupListener(listener);\n      }\n\n      return remaining;\n    }, []);\n\n    if (!events[key].length) delete events[key];\n  });\n\n  return events;\n};\n\nconst getListener = function(obj, listenerObj) {\n  const listeneeId = obj._listenId || (obj._listenId = uniqueId('l'));\n  obj._events = obj._events || {};\n  const listeningTo = listenerObj._listeningTo || (listenerObj._listeningTo = {});\n  const listener = listeningTo[listeneeId];\n\n  // This listenerObj is not listening to any other events on `obj` yet.\n  // Setup the necessary references to track the listening callbacks.\n  if (!listener) {\n    const listenerId = listenerObj._listenId || (listenerObj._listenId = uniqueId('l'));\n    listeningTo[listeneeId] = {obj, listeneeId, listenerId, listeningTo, count: 0};\n\n    return listeningTo[listeneeId];\n  }\n\n  return listener;\n}\n\nconst listenToApi = function({ name, callback, context, listener }) {\n  if (!callback) return;\n\n  const { obj, listenerId } = listener;\n  const listeners = obj._listeners || (obj._listeners = {});\n  obj._events = onApi({ events: obj._events, name, callback, context, listener });\n  listeners[listenerId] = listener;\n  listener.count++;\n\n  // Call `on` for interop\n  obj.on(name, callback, context, { _internal: true });\n};\n\nconst listenToOnceApi = function({ name, callback, context, listener }) {\n  if (!callback) return;\n  const offCallback = this.stopListening.bind(this, listener.obj, name);\n  const onceCallback = onceWrap(callback, offCallback);\n  listenToApi({ name, callback: onceCallback, context, listener });\n};\n\n// Handles triggering the appropriate event callbacks.\nconst triggerApi = function({ events, name, args }) {\n  const objEvents = events[name];\n  const allEvents = (objEvents && events.all) ? events.all.slice() : events.all;\n  if (objEvents) triggerEvents(objEvents, args);\n  if (allEvents) triggerEvents(allEvents, [name].concat(args));\n};\n\n// A difficult-to-believe, but optimized internal dispatch function for\n// triggering events. Tries to keep the usual cases speedy (most internal\n// Backbone events have 3 arguments).\nconst triggerEvents = function(events, args) {\n  each(events, ({ callback, ctx }) => {\n    callHandler(callback, ctx, args);\n  });\n};\n\nexport default {\n\n  // Bind an event to a `callback` function. Passing `\"all\"` will bind\n  // the callback to all events fired.\n  on(name, callback, context, opts) {\n    if (opts && opts._internal) return;\n\n    const eventArgs = buildEventArgs(name, callback, context);\n    this._events = reduce(eventArgs, onReducer.bind(this), this._events || {});\n\n    return this;\n  },\n\n  // Remove one or many callbacks. If `context` is null, removes all\n  // callbacks with that function. If `callback` is null, removes all\n  // callbacks for the event. If `name` is null, removes all bound\n  // callbacks for all events.\n  off(name, callback, context, opts) {\n    if (!this._events) return this;\n    if (opts && opts._internal) return;\n\n    // Delete all event listeners and \"drop\" events.\n    if (!name && !context && !callback) {\n      this._events = void 0;\n      const listeners = this._listeners;\n      each(keys(listeners), listenerId => {\n        cleanupListener(listeners[listenerId]);\n      });\n      return this;\n    }\n\n    const eventArgs = buildEventArgs(name, callback, context);\n\n    this._events = reduce(eventArgs, offReducer, this._events);\n\n    return this;\n  },\n\n  // Bind an event to only be triggered a single time. After the first time\n  // the callback is invoked, its listener will be removed. If multiple events\n  // are passed in using the space-separated syntax, the handler will fire\n  // once for each event, not once for a combination of all events.\n  once(name, callback, context) {\n    const eventArgs = buildEventArgs(name, callback, context);\n\n    this._events = reduce(eventArgs, onceReducer.bind(this), this._events || {})\n\n    return this;\n  },\n\n  // Inversion-of-control versions of `on`. Tell *this* object to listen to\n  // an event in another object... keeping track of what it's listening to\n  // for easier unbinding later.\n  listenTo(obj, name, callback) {\n    if (!obj) return this;\n\n    const listener = getListener(obj, this);\n    const eventArgs = buildEventArgs(name, callback, this, listener);\n    each(eventArgs, listenToApi);\n\n    return this;\n  },\n\n  // Inversion-of-control versions of `once`.\n  listenToOnce(obj, name, callback) {\n    if (!obj) return this;\n\n    const listener = getListener(obj, this);\n    const eventArgs = buildEventArgs(name, callback, this, listener);\n    each(eventArgs, listenToOnceApi.bind(this));\n\n    return this;\n  },\n\n  // Tell this object to stop listening to either specific events ... or\n  // to every object it's currently listening to.\n  stopListening(obj, name, callback) {\n    const listeningTo = this._listeningTo;\n    if (!listeningTo) return this;\n\n    const eventArgs = buildEventArgs(name, callback, this);\n\n    const listenerIds = obj ? [obj._listenId] : keys(listeningTo);\n    for (let i = 0; i < listenerIds.length; i++) {\n      const listener = listeningTo[listenerIds[i]];\n\n      // If listening doesn't exist, this object is not currently\n      // listening to obj. Break out early.\n      if (!listener) break;\n\n      each(eventArgs, args => {\n        const listenToObj = listener.obj;\n        const events = listenToObj._events;\n\n        if (!events) return;\n\n        listenToObj._events = offReducer(events, args);\n\n        // Call `off` for interop\n        listenToObj.off(args.name, args.callback, this, { _internal: true });\n      });\n    }\n\n    return this;\n  },\n\n  // Trigger one or many events, firing all bound callbacks. Callbacks are\n  // passed the same arguments as `trigger` is, apart from the event name\n  // (unless you're listening on `\"all\"`, which will cause your callback to\n  // receive the true name of the event as the first argument).\n  trigger(name, ...args) {\n    if (!this._events) return this;\n\n    if (name && typeof name === 'object') {\n      each(keys(name), key => {\n        triggerApi({\n          events: this._events,\n          name: key,\n          args: [name[key]],\n        });\n      });\n    }\n\n    if (name && eventSplitter.test(name)) {\n      each(name.split(eventSplitter), n => {\n        triggerApi({\n          events: this._events,\n          name: n,\n          args,\n        });\n      });\n      return this;\n    }\n\n    triggerApi({\n      events: this._events,\n      name,\n      args,\n    });\n\n    return this;\n  },\n};\n","import { each, extend, keys, reduce } from 'underscore';\n\nimport { buildEventArgs, callHandler, eventSplitter, makeCallback, onceWrap } from './utils';\n\nimport Radio from './index';\n\n/*\n * Requests\n * -----------------------\n * A messaging system for requesting data.\n *\n */\n\nconst replyReducer = function(isOnce, requests, { name, callback, context }) {\n  if (requests[name]) {\n    Radio.debugLog('A request was overwritten', name, this.channelName);\n  }\n\n  requests[name] = {\n    callback: isOnce ? onceWrap(makeCallback(callback), this.stopReplying.bind(this, name)) : makeCallback(callback),\n    context: context || this,\n  };\n\n  return requests;\n};\n\nconst stopReducer = function(requests, { name, callback, context }) {\n  const names = name ? [name] : keys(requests);\n\n  each(names, key => {\n    const handler = requests[key];\n\n    // Bail out if there are no events stored.\n    if (\n      !handler ||\n        callback && callback !== handler.callback &&\n          callback !== handler.callback._callback ||\n            context && context !== handler.context\n    ) {\n      Radio.debugLog('Attempted to remove the unregistered request', name, this.channelName);\n      return;\n    }\n\n    delete requests[key];\n  });\n\n  return requests;\n};\n\nexport default {\n\n  // Set up a handler for a request\n  reply(name, callback, context) {\n    const eventArgs = buildEventArgs(name, callback, context);\n\n    this._requests = reduce(eventArgs, replyReducer.bind(this, false), this._requests || {});\n\n    return this;\n  },\n\n  // Set up a handler that can only be requested once\n  replyOnce(name, callback, context) {\n    const eventArgs = buildEventArgs(name, callback, context);\n\n    this._requests = reduce(eventArgs, replyReducer.bind(this, true), this._requests || {});\n\n    return this;\n  },\n\n  // Remove handler(s)\n  stopReplying(name, callback, context) {\n    if (!this._requests) return this;\n\n    if (!name && !callback && !context) {\n      delete this._requests;\n      return this;\n    }\n\n    const eventArgs = buildEventArgs(name, callback, context);\n    this._requests = reduce(eventArgs, stopReducer.bind(this), this._requests || {});\n\n    return this;\n  },\n\n  // Make a request\n  request(name, ...args) {\n    if (name && typeof name === 'object') {\n      return reduce(keys(name), (replies, key) => {\n        const result  = this.request(key, name[key]);\n        eventSplitter.test(key) ? extend(replies, result) : replies[key] = result;\n        return replies;\n      }, {});\n    }\n\n    if (name && eventSplitter.test(name)) {\n      return reduce(name.split(eventSplitter), (replies, n) => {\n        replies[n] = this.request(n, ...args);\n        return replies;\n      }, {});\n    }\n\n    const channelName = this.channelName;\n    const requests = this._requests;\n\n    // Check if we should log the request, and if so, do it\n    if (channelName && this._tunedIn) {\n      Radio.log.apply(this, [channelName, name].concat(args));\n    }\n\n    // If the request isn't handled, log it in DEBUG mode and exit\n    if (requests && (requests[name] || requests['default'])) {\n      const handler = requests[name] || requests['default'];\n      args = requests[name] ? args : arguments;\n      return callHandler(handler.callback, handler.context, args);\n    }\n\n    Radio.debugLog('An unhandled request was fired', name, channelName);\n  },\n};\n","import { each, extend, keys } from 'underscore';\n\nimport Events from './events';\nimport Requests from './requests';\n\nimport { callHandler } from './utils';\n\n\nconst Radio = {};\n\nRadio.VERSION = '<%= version %>';\n\n// Whether or not we're in DEBUG mode or not. DEBUG mode helps you\n// get around the issues of lack of warnings when events are mis-typed.\nRadio.DEBUG = false;\n\n// Format debug text.\nfunction debugText(warning, eventName, channelName) {\n  return warning + (channelName ? ` on the ${ channelName } channel` : '') +\n    `: \"${ eventName }\"`;\n}\n\n// This is the method that's called when an unregistered event was called.\n// By default, it logs warning to the console. By overriding this you could\n// make it throw an Error, for instance. This would make firing a nonexistent event\n// have the same consequence as firing a nonexistent method on an Object.\nRadio.debugLog = function(warning, eventName, channelName) {\n  if (Radio.DEBUG && console && console.warn) {\n    console.warn(debugText(warning, eventName, channelName));\n  }\n};\n\n/*\n * tune-in\n * -------\n * Get console logs of a channel's activity\n *\n */\n\nconst _logs = {};\n\n// This is to produce an identical function in both tuneIn and tuneOut,\n// so that Backbone.Events unregisters it.\nfunction _partial(channelName) {\n  return _logs[channelName] || (_logs[channelName] = Radio.log.bind(Radio, channelName));\n}\n\nextend(Radio, {\n\n  // Log information about the channel and event\n  log(channelName, eventName, ...args) {\n    if (typeof console === 'undefined') { return; }\n    console.log(`[${ channelName }] \"${ eventName }\"`, args);\n  },\n\n  // Logs all events on this channel to the console. It sets an\n  // internal value on the channel telling it we're listening,\n  // then sets a listener on the Backbone.Events\n  tuneIn(channelName) {\n    const channel = Radio.channel(channelName);\n    channel._tunedIn = true;\n    channel.on('all', _partial(channelName));\n    return this;\n  },\n\n  // Stop logging all of the activities on this channel to the console\n  tuneOut(channelName) {\n    const channel = Radio.channel(channelName);\n    channel._tunedIn = false;\n    channel.off('all', _partial(channelName));\n    delete _logs[channelName];\n    return this;\n  }\n});\n\n/*\n * Backbone.Radio.channel\n * ----------------------\n * Get a reference to a channel by name.\n *\n */\n\nRadio._channels = {};\n\nRadio.channel = function(channelName) {\n  if (!channelName) {\n    throw new Error('You must provide a name for the channel.');\n  }\n\n  if (Radio._channels[channelName]) {\n    return Radio._channels[channelName];\n  }\n\n  return (Radio._channels[channelName] = new Radio.Channel(channelName));\n};\n\n/*\n * Backbone.Radio.Channel\n * ----------------------\n * A Channel is an object that extends from Backbone.Events,\n * and Radio.Requests.\n *\n */\n\nRadio.Channel = function(channelName) {\n  this.channelName = channelName;\n};\n\nextend(Radio.Channel.prototype, Events, Requests, {\n\n  // Remove all handlers from the messaging systems of this channel\n  reset() {\n    this.off();\n    this.stopListening();\n    this.stopReplying();\n    return this;\n  },\n});\n\n/*\n * Top-level API\n * -------------\n * Supplies the 'top-level API' for working with Channels directly\n * from Backbone.Radio.\n *\n */\n\neach([Events, Requests], system => {\n  each(keys(system), methodName => {\n    Radio[methodName] = function(channelName, ...args) {\n      const channel = this.channel(channelName);\n      return callHandler(channel[methodName], channel, args);\n    };\n  });\n});\n\nRadio.reset = function(channelName) {\n  const channels = !channelName ? this._channels : [this._channels[channelName]];\n  each(channels, channel => { channel.reset(); });\n};\n\nexport {\n  Events,\n  Requests,\n};\n\nexport default Radio;\n"],"names":["eventSplitter","buildEventArgs","name","callback","context","listener","reduce","keys","eventArgs","key","concat","test","split","n","push","callHandler","args","length","call","apply","makeCallback","result","_callback","onceWrap","offCallback","onceCallback","once","arguments","onApi","events","ctx","handlers","onReducer","onceReducer","off","bind","cleanupListener","obj","listeneeId","listenerId","listeningTo","_listeners","offReducer","names","each","remaining","handler","count","getListener","listenerObj","_listenId","uniqueId","_events","_listeningTo","listenToApi","listeners","on","_internal","listenToOnceApi","stopListening","triggerApi","objEvents","allEvents","all","slice","triggerEvents","opts","listenTo","listenToOnce","listenerIds","i","listenToObj","trigger","replyReducer","isOnce","requests","Radio","debugLog","channelName","stopReplying","stopReducer","reply","_requests","replyOnce","request","replies","extend","_tunedIn","log","VERSION","DEBUG","debugText","warning","eventName","console","warn","_logs","_partial","tuneIn","channel","tuneOut","_channels","Error","Channel","prototype","Events","Requests","reset","system","methodName","channels"],"mappings":"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"}